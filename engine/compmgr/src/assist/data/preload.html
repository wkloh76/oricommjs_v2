<script defer>
  /**
   * Copyright (c) 2025   Loh Wah Kiang
   *
   * openGauss is licensed under Mulan PSL v2.
   * You can use this software according to the terms and conditions of the Mulan PSL v2.
   * You may obtain a copy of Mulan PSL v2 at:
   *
   *          http://license.coscl.org.cn/MulanPSL2
   *
   * THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
   * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
   * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
   * See the Mulan PSL v2 for more details.
   * -------------------------------------------------------------------------
   */
  "use strict";
  /**------------------ Private function--------------------------------------------*/
  const initialize = async (...args) => {
    const [param] = args;
    const { getNestedObject, sanbox } = library.utils;

    for (let [idx, val] of Object.entries(param)) {
      let func = getNestedObject(glib, idx);
      if (func) {
        let rtn = await sanbox(func, val);
        if (rtn) console.log("Error:", idx, "---", rtn.msg);
      }
    }
    return;
  };

  window.addEventListener("DOMContentLoaded", async () => {
    const { default: utils, ...other } = await import("/library/utils.js");
    const { default: workflow } = await import("/library/engine/workflow.js");
    library.utils = {
      ...utils(),
      jptr: other.jptr(),
      handler: other.handler(),
    };
    library.utils.jptr.set(library, "engine/workflow", { ...workflow() });
    const { jptr, mergeDeep } = library.utils;
    const { convtrigger, load, loadlib, regevents, register, run } = library.engine.workflow;


    if (mjs) {
      if (mjs.lib.length > 0) library = mergeDeep(library, await loadlib(mjs.lib));
      if (mjs.initialize.initialize) {
        if (Object.keys(mjs.initialize.initialize).length > 0)
          await initialize(mjs.initialize.initialize);
      } else {
        if (Object.keys(mjs.initialize).length > 0)
          await initialize(mjs.initialize);
      }
    }

    const { webengine, ...injection } = injectionjs;
    if (webengine) {
      let htmlengine = await load(webengine);
      let objfuncs = register([htmlengine, webengine.trigger], { convtrigger, regevents });
      if (webengine.startup) await run([null, webengine.startup, false], { htmlengine, objfuncs });
    }


  });
</script>